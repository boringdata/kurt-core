# Answer

## How to Set Up MotherDuck to Work with dbt

Setting up MotherDuck with dbt involves installing the dbt-duckdb adapter and configuring your `profiles.yml` to connect to MotherDuck. Here's a complete guide:

### Step 1: Install the dbt-duckdb Adapter

Install the dbt-duckdb adapter with MotherDuck support:

```bash
# Using pip
pip install dbt-duckdb[md]

# Or using Poetry
poetry add dbt-duckdb[md]
```

**Note:** The `[md]` extra ensures MotherDuck compatibility is included.

### Step 2: Get Your MotherDuck Token

1. Sign up for a [MotherDuck account](https://motherduck.com/)
2. Sign in to your account
3. Click on **Settings** in the upper right corner
4. Copy your **Service Token** to the clipboard

### Step 3: Set Environment Variables

Export your MotherDuck token as an environment variable:

```bash
export motherduck_token=<your_motherduck_token>
```

### Step 4: Configure profiles.yml

Create or update your `profiles.yml` with a MotherDuck target. The key difference is using `md:` (or `md:<database_name>`) as the path:

```yaml
your_project_name:
  target: dev
  outputs:
    # Local development with DuckDB
    dev:
      type: duckdb
      path: /tmp/dbt.duckdb

    # Production with MotherDuck
    prod:
      type: duckdb
      path: "md:"  # Or "md:your_database_name"
```

**Example with S3 integration:**

```yaml
jaffle_shop:
  target: dev
  outputs:
    dev:
      type: duckdb
      schema: dev_sung
      path: 'md:jaffle_shop'
      threads: 16
      extensions:
        - httpfs
      settings:
        s3_region: "{{ env_var('S3_REGION', 'us-west-1') }}"
        s3_access_key_id: "{{ env_var('S3_ACCESS_KEY_ID') }}"
        s3_secret_access_key: "{{ env_var('S3_SECRET_ACCESS_KEY') }}"

    prod:
      type: duckdb
      schema: prod_sung
      path: 'md:jaffle_shop'
      threads: 16
```

### Step 5: Verify the Connection

Run dbt debug to verify connectivity:

```bash
dbt debug
```

### Step 6: Run Your dbt Project

```bash
dbt build
```

### Key Configuration Details

- **Path format:** Use `md:` to connect to your default MotherDuck database, or `md:<database_name>` to specify a database
- **Authentication:** The adapter automatically reads the `motherduck_token` environment variable
- **Extensions:** Enable `httpfs` extension in your profile if you need to read from S3
- **Schema:** Use schema names to organize dev/prod environments (e.g., `dev_sung`, `prod_sung`)

### Dual Execution Pattern (Local Dev + Cloud Prod)

A common pattern is to use local DuckDB for development and MotherDuck for production:

- **Dev target:** `path: /tmp/dbt.duckdb` (local DuckDB file)
- **Prod target:** `path: "md:"` (MotherDuck cloud)

This enables fast local iteration during development with seamless cloud deployment for production.

### Additional Resources

- [MotherDuck dbt Documentation](https://motherduck.com/docs/integrations/transformation/dbt/)
- [dbt-duckdb adapter GitHub](https://github.com/jwills/dbt-duckdb)

## Sources

- .kurt/sources/motherduck.com/blog/motherduck-duckdb-dbt.md - Comprehensive tutorial on MotherDuck + dbt setup with profiles.yml examples and step-by-step configuration
- .kurt/sources/motherduck.com/blog/duckdb-dbt-e2e-data-engineering-project-part-2.md - End-to-end data engineering project showing dev/prod profile configurations and dual execution patterns
