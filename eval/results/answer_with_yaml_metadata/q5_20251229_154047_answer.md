# Answer

## How to Set Up MotherDuck to Work with dbt

Setting up MotherDuck with dbt involves installing the dbt-duckdb adapter and configuring your profiles.yml to connect to MotherDuck. Here's the step-by-step process:

### Step 1: Install the dbt-duckdb Adapter

Install the dbt-duckdb package with MotherDuck support:

```bash
# Using pip
pip install dbt-duckdb

# Or using Poetry (includes MotherDuck support)
poetry add dbt-duckdb[md]
```

### Step 2: Get Your MotherDuck Token

1. Sign up for a MotherDuck account at https://motherduck.com/
2. Sign in and go to Settings (upper right corner)
3. Copy your Service Token to the clipboard

### Step 3: Configure Environment Variables

Export your MotherDuck token:

```bash
export motherduck_token=<your motherduck token>
```

If you're also using AWS S3 sources, add:

```bash
export S3_REGION=<your region>          # e.g., us-west-1
export S3_ACCESS_KEY_ID=<your access key id>
export S3_SECRET_ACCESS_KEY=<your secret access key>
```

### Step 4: Configure profiles.yml

The key difference between local DuckDB and MotherDuck is the `path` setting. Use `md:` to connect to MotherDuck:

**Basic MotherDuck configuration:**

```yaml
pypi_metrics:
  outputs:
    dev:
      type: duckdb
      path: /tmp/dbt.duckdb     # Local development
    prod:
      type: duckdb
      path: "md:"               # MotherDuck (uses motherduck_token env var)
  target: dev
```

**Full configuration with database name and S3 support:**

```yaml
jaffle_shop:
  target: dev
  outputs:
    dev:
      type: duckdb
      schema: dev_sung
      path: 'md:jaffle_shop'    # Connect to specific MotherDuck database
      threads: 16
      extensions:
        - httpfs
      settings:
        s3_region: "{{ env_var('S3_REGION', 'us-west-1') }}"
        s3_access_key_id: "{{ env_var('S3_ACCESS_KEY_ID') }}"
        s3_secret_access_key: "{{ env_var('S3_SECRET_ACCESS_KEY') }}"

    prod:
      type: duckdb
      schema: prod_sung
      path: 'md:jaffle_shop'
      threads: 16
      extensions:
        - httpfs
      settings:
        s3_region: us-west-1
        s3_access_key_id: "{{ env_var('S3_ACCESS_KEY_ID') }}"
        s3_secret_access_key: "{{ env_var('S3_SECRET_ACCESS_KEY') }}"
```

### Step 5: Initialize and Run Your dbt Project

```bash
# Initialize a new dbt project
dbt init my_project

# Verify connection
dbt debug

# Run your models
dbt build
```

### Key Points

- **Path format**: Use `md:` for default database, or `md:database_name` for a specific MotherDuck database
- **Authentication**: The adapter automatically checks for the `motherduck_token` environment variable
- **Seamless transition**: Since MotherDuck runs DuckDB in the cloud, you can easily switch between local development (`path: /tmp/dbt.duckdb`) and cloud production (`path: "md:"`)
- **Extensions**: The `httpfs` extension enables reading from S3 and other remote sources
- **Incremental models**: Use materialized='incremental' in production targets for efficient data pipelines

### Benefits of MotherDuck + dbt

- **Fast iteration**: DuckDB runs in-process, enabling sub-second dbt builds
- **Easy dev-to-prod**: Same SQL works locally and in the cloud
- **S3 integration**: Read directly from S3 without copying data
- **Dynamic execution**: MotherDuck can run queries locally or in the cloud based on what's optimal

## Sources

- .kurt/sources/motherduck.com/blog/motherduck-duckdb-dbt.md - Primary tutorial on setting up MotherDuck with dbt, including profiles.yml examples
- .kurt/sources/motherduck.com/blog/duckdb-dbt-e2e-data-engineering-project-part-2.md - End-to-end project showing dev/prod configurations with dbt-duckdb
