# Answer

Setting up MotherDuck to work with dbt involves installing the dbt-duckdb adapter and configuring your dbt profile to connect to MotherDuck. Here's a comprehensive guide:

## Prerequisites

1. **Sign up for a MotherDuck account** at motherduck.com
2. **Get your Service Token** from the MotherDuck UI (Settings > Service Token)
3. **Install the dbt-duckdb adapter** created by Josh Wills

## Step-by-Step Setup

### 1. Install Dependencies

Create a Python virtual environment and install the required packages:

```bash
python3 -m venv venv
source venv/bin/activate
python3 -m pip install --upgrade pip
python3 -m pip install dbt-duckdb
```

### 2. Configure Your dbt Profile

Edit your `profiles.yml` file to connect to MotherDuck. The key is using the `md:` prefix in the path to indicate a MotherDuck database:

```yaml
jaffle_shop:
  target: dev
  outputs:
    dev:
      type: duckdb
      schema: dev_schema
      path: 'md:my_database'
      threads: 16
      extensions:
        - httpfs
```

### 3. Set Environment Variables

Export your MotherDuck token as an environment variable:

```bash
export motherduck_token=<your_motherduck_token>
```

If you're also working with S3 data, add those credentials too:

```bash
export S3_REGION=<your_region>
export S3_ACCESS_KEY_ID=<your_access_key>
export S3_SECRET_ACCESS_KEY=<your_secret_key>
```

### 4. Verify Connection

Run `dbt debug` to verify dbt can connect to MotherDuck:

```bash
dbt debug
```

### 5. Run Your dbt Project

Execute your dbt models:

```bash
dbt build
```

## Dual Execution Setup (Local Dev + Cloud Prod)

MotherDuck supports a powerful "dual execution" pattern where you can develop locally with DuckDB while using MotherDuck for production. This can provide ~5x faster dbt runs during development.

Configure your profile with multiple targets:

```yaml
dual_execution:
  outputs:
    local:
      type: duckdb
      path: local.db
      attach:
        - path: "md:"   # attaches all MotherDuck databases
    prod:
      type: duckdb
      path: "md:my_database"
  target: local
```

This allows you to:
- Run queries locally for faster iteration
- Sample data when developing (e.g., using `{% if target.name == 'local' %} using sample 1 % {% endif %}`)
- Push to production when ready

## Key Benefits

- **Speed**: DuckDB's columnar design enables fast analytical queries
- **Cost efficiency**: Local development is free, and MotherDuck enables cloud execution only when needed
- **Simplicity**: Same technologies for dev and production
- **Dynamic execution**: MotherDuck can intelligently run queries locally or in the cloud

## Sources

List each source file you actually read and used, showing the EXACT LOCAL FILE PATH:
- .kurt/sources/motherduck.com/ecosystem/dbt.md - Overview of dbt + MotherDuck integration and its benefits
- .kurt/sources/motherduck.com/glossary/data build tool (dbt).md - General explanation of dbt and its capabilities
- .kurt/sources/motherduck.com/blog/motherduck-duckdb-dbt.md - Detailed step-by-step setup guide including profiles.yml configuration, environment variables, and example repository
- .kurt/sources/motherduck.com/blog/dual-execution-dbt.md - Advanced dual execution configuration for local dev and cloud production workflows
- .kurt/sources/motherduck.com/blog/motherduck-dbt-pipelines.md - Additional dbt pipeline patterns with MotherDuck including incremental models and pre-hooks
