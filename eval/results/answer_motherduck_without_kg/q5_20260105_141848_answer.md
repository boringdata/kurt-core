# Answer

Setting up MotherDuck to work with dbt involves installing the dbt-duckdb adapter and configuring your `profiles.yml` to connect to MotherDuck. Here's a comprehensive guide:

## 1. Install the dbt-duckdb Adapter

Install the dbt adapter with MotherDuck support:

```bash
pip install dbt-duckdb[md]
# Or with Poetry:
poetry add dbt-duckdb[md]
```

## 2. Get Your MotherDuck Service Token

1. Sign up for a MotherDuck account at [motherduck.com](https://motherduck.com)
2. Sign in to the MotherDuck UI
3. Click on settings in the upper right corner
4. Copy your Service Token to the clipboard

## 3. Export the Token as an Environment Variable

```bash
export motherduck_token=<your_motherduck_token>
```

## 4. Configure Your dbt Profile

Create or edit your `profiles.yml` file. The key difference from local DuckDB is the `path` setting - use `md:` prefix to connect to MotherDuck:

### Basic Configuration

```yaml
my_project:
  outputs:
    prod:
      type: duckdb
      path: "md:my_database"  # Creates/connects to 'my_database' on MotherDuck
      threads: 16
  target: prod
```

### Local Dev + Cloud Prod Configuration (Recommended)

For a development workflow where you iterate locally and deploy to MotherDuck:

```yaml
my_project:
  outputs:
    local:
      type: duckdb
      path: local.db
      attach:
        - path: "md:"  # Attaches all MotherDuck databases for reading
    prod:
      type: duckdb
      path: "md:my_database"
  target: local
```

### With S3 Integration

If you're reading data from S3:

```yaml
my_project:
  outputs:
    dev:
      type: duckdb
      schema: dev_schema
      path: "md:my_database"
      threads: 16
      extensions:
        - httpfs
      settings:
        s3_region: "{{ env_var('S3_REGION', 'us-east-1') }}"
        s3_access_key_id: "{{ env_var('S3_ACCESS_KEY_ID') }}"
        s3_secret_access_key: "{{ env_var('S3_SECRET_ACCESS_KEY') }}"
```

## 5. Initialize and Test the Connection

```bash
# Initialize a new dbt project (if needed)
dbt init my_project

# Test the connection
dbt debug

# Run your models
dbt build
```

## Key Benefits of MotherDuck + dbt

- **Fast Development**: Both dbt and DuckDB can run locally, so you can develop and test using the same technologies you run in production
- **Dual Execution**: MotherDuck uses your local computer when queries make more sense to run locally, providing dynamic execution out of the box
- **Seamless Cloud Scaling**: MotherDuck runs DuckDB on your behalf in the cloud while maintaining local development capabilities
- **No Schema Configuration Needed**: DuckDB/MotherDuck doesn't require you to define schemas or tedious configurations to make it work

## Sources

List each source file you actually read and used, showing the EXACT LOCAL FILE PATH:
- .kurt/sources/motherduck.com/ecosystem/dbt.md - Overview of dbt + MotherDuck integration and general description of how they work together
- .kurt/sources/motherduck.com/blog/motherduck-duckdb-dbt.md - Step-by-step tutorial on setting up dbt with MotherDuck, including profiles.yml configuration, environment variable setup, and S3 integration
- .kurt/sources/motherduck.com/glossary/data build tool (dbt).md - General definition of dbt and its capabilities
- .kurt/sources/motherduck.com/blog/dual-execution-dbt.md - Advanced configuration for dual execution (local dev + cloud prod), profile setup with attach for reading from MotherDuck while writing locally
- .kurt/sources/motherduck.com/blog/duckdb-dbt-e2e-data-engineering-project-part-2.md - End-to-end project setup showing dev/prod targets in profiles.yml, MotherDuck authentication via motherduck_token environment variable, and how the `md:` path triggers MotherDuck authentication
